{% extends "app/base.html" %}

{% load static %}

{% block content %}
<div>
  <img src="{{ post.image.url }}" height=400px class="d-block mx-auto">
  <div class="text-center mt-3">
    <h3 class="mt-3">投稿者：<a href="{% url "users_detail" post.user.id %}">{{ post.user }}</a></h3>
    <h3 class="mt-3">魚種：{{ post.fish }}</h3>
    <h3 class="mt-3">サイズ：{{ post.size }}cm</h3>
    <h3 class="mt-3">エリア(県名)：{{ post.pref }}</h3>
    <h3 class="mt-3">エリア(詳細な地名)：{{ post.area }}</h3>

    <div id="map" style="width: 300px; height: 300px; margin: 0 auto;"></div>

    <script>
      function initMap() {

        var target = document.getElementById('map'); //マップを表示する要素を指定
        var address = "{{ post.pref }}" + "{{ post.area }}"; //住所を指定
        var geocoder = new google.maps.Geocoder();

        geocoder.geocode({
          address: address
        }, function (results, status) {
          if (status === 'OK' && results[0]) {

            console.log(results[0].geometry.location);

            var map = new google.maps.Map(target, {
              center: results[0].geometry.location,
              zoom: 18
            });

            var marker = new google.maps.Marker({
              position: results[0].geometry.location,
              map: map,
              animation: google.maps.Animation.DROP
            });

          } else {
            //住所が存在しない場合の処理
            alert('住所が正しくないか存在しません。');
            target.style.display = 'none';
          }
        });
      }
    </script>
    <script src="//maps.google.com/maps/api/js?key=AIzaSyCDj6rE4TQWx2rmbawJo3jO2ORJdWejorA&callback=initMap"></script>
    {% if request.user == post.user %}
    <form method="POST" action="{% url "posts_delete" post.id %}" class="m-5">{% csrf_token %}
      <button class="btn btn-danger" type="submit" onclick="return confirm(" 本当に削除しますか?");">
        削除
      </button>
    </form>
    {% endif %}
  </div>
</div>
{% endblock %}